!function(exports,undefined){"use strict";var mesFonctions={hasParent:function(element,parentTagname){for(var l=(parentTagname=Array.isArray(parentTagname)&&parentTagname||[parentTagname]).length,parent,parentTag,i=0;i!==l;i++)for(parentTag=(parent=element.parentElement).tagName.toLowerCase();parent&&"math"!==parentTag;){if(parent.tagName.toLowerCase()===parentTagname[i])return!0;parentTag=(parent=parent.parentElement).tagName.toLowerCase()}return!1},hasChild:function(element,parentTagname){for(var l=(parentTagname=Array.isArray(parentTagname)&&parentTagname||[parentTagname]).length,i=0;i!==l;i++){var node;if(element.getElementsByTagName(parentTagname[i])[0]||element.tagName.toLowerCase()===parentTagname[i])return!0}return!1},nbChildrens:function(element){return element.querySelectorAll("*").length},getElementsByContainTagName:function(element,tag){tag=Array.isArray(tag)&&tag||[tag];for(var a=[],n=element.getElementsByTagName("*"),l=n.length,i=0;i!==l;i++)for(var node=n[i].tagName.toUpperCase(),ltag=tag.length,j=0;j!==ltag;j++)tag[j]=tag[j].toUpperCase(),-1!==node.indexOf(tag[j])&&a.push(n[i]);return a},block:function(element,openBloc,endBloc){void 0===openBloc&&(openBloc=mathBraille.caracMath.blocks.open),void 0===endBloc&&(endBloc=mathBraille.caracMath.blocks.close);var df=document.createElement("bloc"),blocOuverture=document.createElement("blocOuverture"),blocFermeture=document.createElement("blocFermeture");return blocOuverture.appendChild(document.createTextNode(openBloc)),blocFermeture.appendChild(document.createTextNode(endBloc)),df.appendChild(blocOuverture),df.appendChild(document.createTextNode("\n")),df.appendChild(element),df.appendChild(document.createTextNode("\n")),df.appendChild(blocFermeture),df},_extendDefaults:function(source,properties){var property;for(property in properties)properties.hasOwnProperty(property)&&(source[property]=properties[property]);return source}},optionsBraille={},hardmat,mbraille=function(clmath){this._mesFonctions=mesFonctions,this._writeEq=writeEq,optionsBraille={remplaceFormule:!1,coupureFormule:0,codeBrailleMath:"fr",codeSysteme:"SI",matriceLineaire:!1,maxCaracCell:10,chimie:!1},clmath?"object"==typeof clmath?(optionsBraille=mesFonctions._extendDefaults(optionsBraille,clmath),clmath="math"):arguments[1]&&"object"==typeof arguments[1]&&(optionsBraille=mesFonctions._extendDefaults(optionsBraille,arguments[1])):clmath="math";var mesFormules=clmath&&document.querySelectorAll(clmath),l=mesFormules.length,i=0;for(this._formules=mesFormules;i!==l;i++){mathBraille=allVar[optionsBraille.codeBrailleMath].mathBraille,mesFormules[i].setAttribute("aria-hidden",!0);var parent=mesFormules[i].parentNode,m=document.createElement("math"),maForm=document.createElement("span");m.innerHTML=mesFormules[i].innerHTML,writeEq._supprimeprefix(m),writeEq._superflus(m),writeEq._inutile(m),writeEq._tableSeul(m),writeEq._mspace(m),writeEq._espace(m),optionsBraille.chimie&&writeEq._moverChimie(m),optionsBraille.chimie&&writeEq._munderChimie(m),optionsBraille.chimie&&writeEq._munderoverChimie(m),"nemeth"===optionsBraille.codeBrailleMath&&(writeEq._numDecimalNemeth(m),writeEq._espaceNemeth(m)),hardmat=writeEq._boolHardMatrice(m),writeEq._ajoutmfenced(m),writeEq._pbBlocs(m),writeEq._pbIntegrale(m),writeEq._newMfracBloc(m),writeEq._newMsqrtBloc(m),writeEq._newMrootBloc(m),writeEq._reecritureMultiscripts(m),writeEq._newMmultiscriptsBloc(m),writeEq._newMsubsupBloc(m),writeEq._newMunderover(m),writeEq._newMsupBloc(m),writeEq._newMsubBloc(m),writeEq._newPlacementMultiscript(m),writeEq._newMfracWrite(m),writeEq._newMsqrtWrite(m),writeEq._newMrootWrite(m),writeEq._newIndiceExposantWrite(m),writeEq._newBlocBase(m),writeEq._mover(m,"mover"),writeEq._munder(m),writeEq._mfenced(m),writeEq._mn(m),writeEq._mo(m),writeEq._mi(m),writeEq._mtext(m),(optionsBraille.matriceLineaire||hardmat)&&writeEq._matriceLineaire(m),writeEq._writeform(m),maForm.innerHTML=m.innerHTML,maForm.classList.add("js-mathmlConverti"),parent.insertBefore(maForm,mesFormules[i].nextSibling),optionsBraille.remplaceFormule?mesFormules[i].setAttribute("style","display:none"):mesFormules[i].removeAttribute("style")}},brailledirect=function(maClass,codeBrailleMath){codeBrailleMath=codeBrailleMath&&codeBrailleMath||"fr";for(var tbf6=document.querySelectorAll(maClass),l=tbf6.length,i=0;i!==l;i++){var maTable=allVar[codeBrailleMath].TBdbt;tbf6[i].textContent=tbf6[i].textContent.braille(maTable)}};String.prototype.isNumeric=function(){if(-1===Math.sign(this))return!1;let n=this.replace(/\./g,"").replace(",",".").replace(/\n|\r|\t|\s/g,"");return!isNaN(parseFloat(n))&&isFinite(n)},String.prototype.trimCar=function(car){let deb=new RegExp("^"+car),fin=new RegExp(car+"$");return this.replace(deb,"").replace(fin,"")},String.prototype.trimall=function(){return this.replace(/\s*/gi,"")},String.prototype.braille=function(maTable){let maString=this.trimCar("-");for(var brailleUnicode={BLANK:10240,1:10241,12:10243,123:10247,1234:10255,12345:10271,123456:10303,1234567:10367,12345678:10495,1234568:10431,123457:10335,1234578:10463,123458:10399,12346:10287,123467:10351,1234678:10479,123468:10415,12347:10319,123478:10447,12348:10383,1235:10263,12356:10295,123567:10359,1235678:10487,123568:10423,12357:10327,123578:10455,12358:10391,1236:10279,12367:10343,123678:10471,12368:10407,1237:10311,12378:10439,1238:10375,124:10251,1245:10267,12456:10299,124567:10363,1245678:10491,124568:10427,12457:10331,124578:10459,12458:10395,1246:10283,12467:10347,124678:10475,12468:10411,1247:10315,12478:10443,1248:10379,125:10259,1256:10291,12567:10355,125678:10483,12568:10419,1257:10323,12578:10451,1258:10387,126:10275,1267:10339,12678:10467,1268:10403,127:10307,1278:10435,128:10371,13:10245,134:10253,1345:10269,13456:10301,134567:10365,1345678:10493,134568:10429,13457:10333,134578:10461,13458:10397,1346:10285,13467:10349,134678:10477,13468:10413,1347:10317,13478:10445,1348:10381,135:10261,1356:10293,13567:10357,135678:10485,13568:10421,1357:10325,13578:10453,1358:10389,136:10277,1367:10341,13678:10469,1368:10405,137:10309,1378:10437,138:10373,14:10249,145:10265,1456:10297,14567:10361,145678:10489,14568:10425,1457:10329,14578:10457,1458:10393,146:10281,1467:10345,14678:10473,1468:10409,147:10313,1478:10441,148:10377,15:10257,156:10289,1567:10353,15678:10481,1568:10417,157:10321,1578:10449,158:10385,16:10273,167:10337,1678:10465,168:10401,17:10305,178:10433,18:10369,2:10242,23:10246,234:10254,2345:10270,23456:10302,234567:10366,2345678:10494,234568:10430,23457:10334,234578:10462,23458:10398,2346:10286,23467:10350,234678:10478,23468:10414,2347:10318,23478:10446,2348:10382,235:10262,2356:10294,23567:10358,235678:10486,23568:10422,2357:10326,23578:10454,2358:10390,236:10278,2367:10342,23678:10470,2368:10406,237:10310,2378:10438,238:10374,24:10250,245:10266,2456:10298,24567:10362,245678:10490,24568:10426,2457:10330,24578:10458,2458:10394,246:10282,2467:10346,24678:10474,2468:10410,247:10314,2478:10442,248:10378,25:10258,256:10290,2567:10354,25678:10482,2568:10418,257:10322,2578:10450,258:10386,26:10274,267:10338,2678:10466,268:10402,27:10306,278:10434,28:10370,3:10244,34:10252,345:10268,3456:10300,34567:10364,345678:10492,34568:10428,3457:10332,34578:10460,3458:10396,346:10284,3467:10348,34678:10476,3468:10412,347:10316,3478:10444,348:10380,35:10260,356:10292,3567:10356,35678:10484,3568:10420,357:10324,3578:10452,358:10388,36:10276,367:10340,3678:10468,368:10404,37:10308,378:10436,38:10372,4:10248,45:10264,456:10296,4567:10360,45678:10488,4568:10424,457:10328,4578:10456,458:10392,46:10280,467:10344,4678:10472,468:10408,47:10312,478:10440,48:10376,5:10256,56:10288,567:10352,5678:10480,568:10416,57:10320,578:10448,58:10384,6:10272,67:10336,678:10464,68:10400,7:10304,78:10432,8:10368},tmpTable=maTable&&maTable||brailleUnicode,txt=maTable&&maString.split("")||maString.split("-"),l=txt.length,i=0;i!==l;i++){if(!tmpTable[txt[i]])return'caractère "'+txt[i]+" ; "+txt[i].charCodeAt()+'" non défini';maTable&&txt.splice(i,1,brailleUnicode[maTable[txt[i]]])||txt.splice(i,1,brailleUnicode[txt[i]])}return String.fromCharCode.apply(String,txt)};var mathBraille={};const braillemarqueCell="-124578-",braillemarqueMat="-1234567-",braillemarqueClose="-1278-",braillemarqueRetourLigne="-12345678-",marqueCell="-124578-".braille(),marqueMat="-1234567-".braille(),marqueClose="-1278-".braille(),marqueRetourLigne="-12345678-".braille(),espace=String.fromCharCode(10240);let writeEq={_munderoverChimie:function(monEquation){for(var munderover=monEquation.getElementsByTagName("munderover"),i=0,l=munderover.length;i<l;i++){let parent=munderover[i].parentNode,elt=munderover[i].children;if(8652===elt[0].textContent.trim().charCodeAt()){let mfenced=document.createElement("mfenced"),mrow=document.createElement("mrow");mfenced.appendChild(elt[2]),mfenced.appendChild(document.createTextNode("-23-")),mfenced.appendChild(elt[1]),mrow.appendChild(elt[0]),mrow.appendChild(mfenced),parent.replaceChild(mrow,munderover[i])}}},_moverChimie:function(monEquation){for(var mover=monEquation.getElementsByTagName("mover"),i=mover.length;i--;){let elt=mover[i].children,parent=mover[i].parentNode;if(8652===elt[0].textContent.trim().charCodeAt()){let mfenced=document.createElement("mfenced"),mrow=document.createElement("mrow");mfenced.appendChild(elt[1]),mfenced.appendChild(document.createTextNode("-23-")),mfenced.appendChild(document.createTextNode("-5-2-")),mrow.appendChild(elt[0]),mrow.appendChild(mfenced),parent.replaceChild(mrow,mover[i])}else if("mi"===elt[1].tagName.toLowerCase()){let mfenced=document.createElement("mfenced"),mi=document.createElement("mi");mi.innerHTML=elt[1].innerHTML,mfenced.appendChild(mi),mover[i].replaceChild(mfenced,elt[1])}else{let mrow=document.createElement("mrow");mrow.appendChild(elt[0]),mrow.appendChild(elt[0]),parent.replaceChild(mrow,mover[i])}}},_munderChimie:function(monEquation){for(var mover=monEquation.getElementsByTagName("munder"),i=0,l=mover.length;i<l;i++){let elt;if("mo"===mover[i].children[1].tagName.toLowerCase()){let parent=mover[i].parentNode,mrow=document.createElement("mrow");mrow.innerHTML=mover[i].innerHTML,parent.replaceChild(mrow,mover[i])}}},_mspace:function(monEquation){for(var space=monEquation.getElementsByTagName("mspace");space[0];){var parent=space[0].parentNode,mtext=document.createElement("mi");mtext.textContent=" ",parent.replaceChild(mtext,space[0])}},_espace:function(monEquation){var mtext;monEquation.querySelectorAll("mtext").forEach(t=>{160===t.textContent.charCodeAt()&&(t.textContent=" ")})},_numDecimalNemeth:function(monEquation){for(var mo=monEquation.getElementsByTagName("mo"),lmo=mo.length,i=0;i!==lmo;i++){var elt=mo[i];if(","===elt.textContent.trim()&&"SI"===optionsBraille.codeSysteme)if("mn"===elt.previousElementSibling.tagName.toLowerCase()&&"mn"===elt.nextElementSibling.tagName.toLowerCase())elt.textContent=".";else if(160!==elt.nextElementSibling.textContent.charCodeAt()){var bloc=document.createElement("space-bloc"),parent=elt.parentNode;bloc.appendChild(document.createTextNode(mathBraille.caracMath.espaceInsecable)),parent.insertBefore(bloc,elt.nextSibling)}}},_espaceNemeth:function(monEquation){for(var bloc,mo=monEquation.getElementsByTagName("mo"),lmo=mo.length,i=0;i!==lmo;){var boolparent=mesFonctions.hasParent(mo[i],["msub","msup"]);if(160===mo[i].textContent.charCodeAt()&&!boolparent){var parent=mo[i].parentNode;(bloc=document.createElement("space-bloc")).appendChild(document.createTextNode(mathBraille.caracMath.espaceInsecable)),parent.replaceChild(bloc,mo[i]),lmo--,i--}i++}},_pbIntegrale:function(monEquation){for(var subsup=monEquation.getElementsByTagName("msubsup"),lsubsup=subsup.length,i=0;i!==lsubsup;i++){var enfants=subsup[i].children,next=subsup[i].nextElementSibling,parent=subsup[i].parentNode;if(8747===enfants[0].textContent.charCodeAt()&&"mn"===next.tagName.toLowerCase()){for(parent.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.open),subsup[i].nextSibling);next&&"d"!==next.textContent;)next=next.nextElementSibling;next&&"mi"===next.nextElementSibling.tagName&&parent.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.close),next)}}},_pbBlocs:function(monEquation){for(var zap=["msub","msup"],qui=["cos","sin","lim","ch","sh","ln","log","Card","tan","arctan","arcsin","arccos","arccotan"],mi=monEquation.getElementsByTagName("mi"),lmi=mi.length,i=0;i!==lmi;i++){var txt=mi[i].textContent.trimall(),parent=mi[i].parentNode,first,last,lastprevious;if(-1!==qui.indexOf(txt)){if("lim"===txt){for(;"munder"!==parent.tagName.toLowerCase();)parent=parent.parentNode;if("mfrac"===parent.nextElementSibling.tagName.toLowerCase()){var frac=parent.nextElementSibling;parent=parent.parentNode;var bloc=document.createElement("mfrac");bloc.innerHTML=frac.innerHTML,parent.replaceChild(mesFonctions.block(bloc),frac)}continue}if(-1===zap.indexOf(parent.tagName.toLowerCase())&&(parent=mi[i]),last=first=parent.nextElementSibling,first&&"mfenced"===first.tagName.toLowerCase()||first&&-1!==first.textContent.indexOf("(")||first&&mesFonctions.nbChildrens(first)>1)continue;if("mfrac"===parent.nextElementSibling.tagName.toLowerCase()){frac=parent.nextElementSibling,parent=parent.parentNode,(bloc=document.createElement("mfrac")).innerHTML=frac.innerHTML,parent.replaceChild(mesFonctions.block(bloc),frac);continue}for(;last&&"mo"!==last.tagName.toLowerCase()&&1===last.textContent.trimall().length;)lastprevious=last,last=last.nextElementSibling;last?(last=last.previousElementSibling,parent.parentNode.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.open),first),parent.parentNode.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.close),last.nextSibling)):lastprevious&&(parent.parentNode.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.open),first),parent.parentNode.insertBefore(document.createTextNode(mathBraille.caracMath.blocks.close),lastprevious.nextSibling))}}},_tableSeul:function(monEquation){var tbl=monEquation.getElementsByTagName("mtable"),bloc=document.createElement("mtable-bloc");if(tbl.length>0&&1===monEquation.children.length){var Tagenfant=monEquation.children[0].tagName,parent=tbl[0].parentNode;if("mtable"===Tagenfant.toLowerCase()){for(var tr=tbl[0].getElementsByTagName("mtr"),ltr=tr.length,i=0;i!==ltr;i++)i!==ltr-1&&tr[i].appendChild(document.createTextNode("-12345678-"));for(;tr[0];)bloc.appendChild(tr[0]);parent.replaceChild(bloc,tbl[0])}}},_boolHardMatrice:function(monEquation){var tbl=monEquation.getElementsByTagName("mtable");if(tbl.length>1)return!0;if(0===tbl.length)return!1;for(var td=tbl[0].getElementsByTagName("mtd"),ltd=td.length,i=0,tailleCell=0;i!==ltd;i++){var t=td[i].textContent.replace(/\s*/gi,"").length;tailleCell<=t&&(tailleCell=t)}return tailleCell>=optionsBraille.maxCaracCell},_supprimeprefix:function(monEquation){let mesDom;monEquation.querySelectorAll("*").forEach(dom=>{let tag=dom.tagName.split(":"),parent=dom.parentNode;if(tag.length>1){let tmp=document.createElement(tag[1]);tmp.innerHTML=dom.innerHTML,parent.replaceChild(tmp,dom)}})},_inutile:function(monEquation){for(var mesTags=["annotation-xml","annotation"],l=mesTags.length,i=0;i!==l;i++)for(var inutile=monEquation.getElementsByTagName(mesTags[i]);inutile[0];){var parent;inutile[0].parentNode.removeChild(inutile[0])}},_superflus:function(monEquation){let mesTags=["mstyle"],l=mesTags.length,i=0,df=document.createDocumentFragment();for(;i!==l;i++){let superflus=monEquation.getElementsByTagName(mesTags[i]);for(;superflus[0];){let enfants=superflus[0].children,parent=superflus[0].parentNode;for(;enfants[0];)df.appendChild(enfants[0]);parent.replaceChild(df,superflus[0])}}},_ajoutmfenced:function(monEquation){let mo=monEquation.querySelectorAll("mo");const paraOpen=["(","[","{","|","‖"],paraClose=[")","]","}","|","‖"];mo.forEach(m=>{let fenced=document.createElement("mfenced"),parent=m.parentNode,i=paraOpen.indexOf(m.textContent);-1!==i&&m.nextElementSibling&&("mtable"===m.nextElementSibling.tagName.toLowerCase()||mesFonctions.hasChild(m.nextElementSibling,"mtable"))&&(fenced.setAttribute("open",paraOpen[i]),fenced.setAttribute("close",""),fenced.appendChild(m.nextElementSibling),m.nextElementSibling&&m.nextElementSibling.textContent===paraClose[i]&&(fenced.setAttribute("close",paraClose[i]),parent.removeChild(m.nextElementSibling)),parent.replaceChild(fenced,m))})},_reecritureMultiscripts:function(eq){let multis;eq.querySelectorAll("mmultiscripts").forEach(m=>{let multi=m.children,elts=[];"mprescripts"===multi[1].tagName.toLowerCase()?(elts.push(document.createElement("none")),elts.push(document.createElement("none")),elts.push(multi[1]),elts.push(multi[2]),elts.push(multi[3])):(elts.push(multi[1]),elts.push(multi[2]),elts.push(multi[3]),elts.push(multi[4]),elts.push(multi[5])),elts.forEach(elt=>m.appendChild(elt))})},_newMmultiscriptsBloc:function(eq){for(var multiscripts=eq.getElementsByTagName("mmultiscripts"),lmultiscripts=multiscripts.length,i=0;i!==lmultiscripts;i++){for(var elts=multiscripts[i].children,monMulti=document.createElement("mmultiscripts"),k=0,lelts=elts.length;k!==lelts;k++){var lvl=writeEq._newNiveauIndiceExposant(elts[k]),id=document.createElement(elts[k].tagName.toLowerCase());if(id.innerHTML=elts[k].innerHTML,-1!==lvl){var bloc=document.createElement("blocmulti-"+lvl);writeEq._conditionsIndiceNum(elts[0],elts[1],lvl)&&1===k&&(bloc=document.createElement("blocIndiceNum-"+lvl)),bloc.appendChild(id),monMulti.appendChild(bloc)}else 0===k?((bloc=document.createElement("blocbase")).appendChild(id),monMulti.appendChild(bloc)):monMulti.appendChild(id)}multiscripts[i].innerHTML=monMulti.innerHTML}},_newPlacementMultiscript:function(eq){for(var multiscripts=eq.getElementsByTagName("mmultiscripts");multiscripts[0];){var parent=multiscripts[0].parentElement,bloc=document.createElement("mmultiscripts-f"),enfants=multiscripts[0].children;optionsBraille.chimie?(bloc.appendChild(enfants[0]),bloc.appendChild(document.createTextNode(mathBraille.caracMath.point6)),bloc.appendChild(enfants[3]),bloc.appendChild(document.createTextNode(mathBraille.caracMath.point6)),bloc.appendChild(enfants[3]),bloc.appendChild(enfants[0]),bloc.appendChild(enfants[0])):(bloc.appendChild(enfants[5]),bloc.appendChild(enfants[4]),bloc.appendChild(enfants[0]),bloc.appendChild(enfants[0]),bloc.appendChild(enfants[0])),(multiscripts[0].nextElementSibling||multiscripts[0].previousElementSibling)&&(bloc=mesFonctions.block(bloc)),parent.replaceChild(bloc,multiscripts[0])}},_mfenced:function(monEquation){for(var fenced=monEquation.getElementsByTagName("mfenced"),open,close,sep,mtable,parent,monBlock;fenced[0];){if(monBlock=document.createElement("mfenced-block"),null===(open=fenced[0].getAttribute("open"))&&(open="("),1===open.split("").length&&(open=open.charCodeAt()),null===(close=fenced[0].getAttribute("close"))&&(close=")"),1===close.split("").length&&(close=close.charCodeAt()),mtable=fenced[0].getElementsByTagName("mtable"),parent=fenced[0].parentNode,sep=fenced[0].getAttribute("separators")){var s=sep.split(""),slast,enfants=fenced[0].children,i=0;let row=document.createElement("mrow");for(;enfants[0];){let mo=document.createElement("mo");s[i]=s[i]||slast,mo.appendChild(document.createTextNode(s[i])),slast=s[i]&&s[i],row.appendChild(enfants[0]),enfants[0]&&row.appendChild(mo),i++}fenced[0].appendChild(row)}monBlock.innerHTML=fenced[0].innerHTML;var monBool=0!==mtable.length&&(optionsBraille.matriceLineaire||hardmat);switch(open){case 40:open=monBool&&mathBraille.caracMath.grandeparenthese2.open||mathBraille.caracMath.parenthese.open;break;case 91:open=monBool&&mathBraille.caracMath.grandcrochet2.open||mathBraille.caracMath.crochet.open;break;case 93:open=monBool&&mathBraille.caracMath.grandcrochet2.close||mathBraille.caracMath.crochet.close;break;case 123:open=monBool&&mathBraille.caracMath.grandeaccolade.open||""!==close&&mathBraille.caracMath.accolade.open||mathBraille.caracMath.grandeaccolade.open;break;case 8739:case 124:open=monBool&&mathBraille.caracMath.grandebarre.open||mathBraille.caracMath.barre.open;break;case 8214:case 8741:case"||":open=monBool&&mathBraille.caracMath.grandedoublebarre.open||mathBraille.caracMath.doublebarre.open;break;case 10214:open=mathBraille.caracMath.crochetdouble.open}switch(close){case 41:close=monBool&&mathBraille.caracMath.grandeparenthese2.close||mathBraille.caracMath.parenthese.close;break;case 93:close=monBool&&mathBraille.caracMath.grandcrochet2.close||mathBraille.caracMath.crochet.close;break;case 91:close=monBool&&mathBraille.caracMath.grandcrochet2.open||mathBraille.caracMath.crochet.open;break;case 125:close=monBool&&mathBraille.caracMath.grandeaccolade.close||mathBraille.caracMath.accolade.close;break;case 124:close=monBool&&mathBraille.caracMath.grandebarre.close||mathBraille.caracMath.barre.close;break;case 8214:case 8741:case"||":close=monBool&&mathBraille.caracMath.grandedoublebarre.close||mathBraille.caracMath.doublebarre.close;break;case 10215:close=mathBraille.caracMath.crochetdouble.close}!optionsBraille.matriceLineaire&&!hardmat&&writeEq._matriceBlock(open,close,monBlock),parent.replaceChild(mesFonctions.block(monBlock,open,close),fenced[0])}},_matriceBlock:function(open,close,monBlock){for(var tbl=monBlock.getElementsByTagName("mtable"),ltbl=tbl.length,parent,txtNode,tr,td,ltd,ltr,j,k,i=0;i!==ltbl;i++)for((parent=tbl[i].parentNode).insertBefore(document.createTextNode("-1234567-"),tbl[i]),close&&parent.insertBefore(document.createTextNode("-1278-"),tbl[i]),ltr=(tr=tbl[i].getElementsByTagName("mtr")).length,j=0;j!==ltr;j++)for(txtNode=close&&close+"-12345678-"+open||"-12345678-",j!==ltr-1&&tbl[i].insertBefore(document.createTextNode(txtNode),tr[j].nextSibling),ltd=(td=tr[j].getElementsByTagName("mtd")).length,k=0;k!==ltd;k++)parent=td[k].parentNode,0===td[k].textContent.trim().length&&td[k].appendChild(document.createTextNode(mathBraille.caracMath.matrice.caseVide)),k!==ltd-1&&parent.insertBefore(document.createTextNode(mathBraille.caracMath.espaceInsecable),td[k].nextSibling),parent.insertBefore(document.createTextNode("-124578-"),td[k].nextSibling),parent.insertBefore(document.createTextNode("-124578-"),td[k]);return monBlock},_matriceLineaire:function(monEquation){for(var tbl=monEquation.getElementsByTagName("mtable"),ltbl=tbl.length,tr,td,ltd,ltr,j,k,i=0;i!==ltbl;i++){for(ltr=(tr=tbl[i].getElementsByTagName("mtr")).length,j=0;j!==ltr;j++)j!==ltr-1&&tr[j].appendChild(document.createTextNode(mathBraille.caracMath.matrice.sepLigne+mathBraille.caracMath.espaceInsecable));for(ltd=(td=tbl[i].getElementsByTagName("mtd")).length,k=0;k!==ltd;k++)0===td[k].textContent.trim().length&&td[k].appendChild(document.createTextNode(mathBraille.caracMath.matrice.caseVide)),k!==ltd-1&&td[k].appendChild(document.createTextNode(mathBraille.caracMath.espaceInsecable))}},_newMsubsupBloc:function(eq,tag){tag=tag&&tag||"msubsup";let msubsup=eq.getElementsByTagName(tag),nomBloc="munderover"===tag?"blocunderover-":"blocsubsup-",indicateurBase=mathBraille.caracMath.indicateurBase&&mathBraille.caracMath.indicateurBase||"";for(;msubsup[0];){let parent=msubsup[0].parentNode,bloc=document.createElement(tag+"-f"),lvlsub=writeEq._newNiveauIndiceExposant(msubsup[0].children[1]),lvlsup=writeEq._newNiveauIndiceExposant(msubsup[0].children[2]),blocsup=-1===lvlsup&&document.createElement("bloc")||document.createElement(nomBloc+lvlsup),blocsub=-1===lvlsub&&document.createElement("bloc")||document.createElement(nomBloc+lvlsub);blocsub=writeEq._conditionsIndiceNum(msubsup[0].children[0],msubsup[0].children[1],lvlsub)&&document.createElement("blocIndiceNum-"+lvlsub)||blocsub,blocsup.appendChild(msubsup[0].children[2]),blocsub.appendChild(msubsup[0].children[1]),bloc.appendChild(msubsup[0].children[0]),bloc.appendChild(blocsub),bloc.appendChild(blocsup),bloc=mesFonctions.block(bloc,"",indicateurBase),parent.replaceChild(bloc,msubsup[0])}},_majus:function(monEquation,tagName){for(var mn=monEquation.getElementsByTagName(tagName),l=mn.length,i=0;i!==l;i++){let scriptBool=mn[i].getAttribute("mathvariant")&&"script"===mn[i].getAttribute("mathvariant"),doubleStruckBool=mn[i].getAttribute("mathvariant")&&"double-struck"===mn[i].getAttribute("mathvariant");if(scriptBool&&(mn[i].textContent=mn[i].textContent.toLowerCase()),";"===mn[i].textContent.trim()&&optionsBraille.chimie)mn[i].textContent=mathBraille.caracMath.point6+mathBraille.caracDec[mn[i].textContent.trim().charCodeAt()];else if(" "===mn[i].textContent)mn[i].textContent=mathBraille.caracMath.espaceInsecable;else{var num=mn[i].textContent.length>1&&mn[i].textContent.trim().split("")||mn[i].textContent.split(""),carac="",lnum=num.length,j=0;for(mn[i].textContent="";j<lnum;j++){let moncar;moncar=optionsBraille.chimie?mathBraille.caracDec[num[j].charCodeAt()]&&mathBraille.caracDec[num[j].charCodeAt()].chimie?mathBraille.caracDec[num[j].charCodeAt()].chimie:mathBraille.caracDec[num[j].charCodeAt()]:mathBraille.caracDec[num[j].charCodeAt()]&&mathBraille.caracDec[num[j].charCodeAt()].math?mathBraille.caracDec[num[j].charCodeAt()].math:mathBraille.caracDec[num[j].charCodeAt()],carac=moncar||num[j],carac=scriptBool&&mathBraille.caracMath.majusculeronde+carac||carac,carac=doubleStruckBool&&mathBraille.caracMath.majuscule+carac||carac,mn[i].textContent+=carac}}}},_mi:function(monEquation){writeEq._majus(monEquation,"mi")},_mo:function(monEquation){writeEq._majus(monEquation,"mo")},_mtext:function(monEquation){writeEq._majus(monEquation,"mtext")},_mn:function(monEquation){if("ueb"===optionsBraille.codeBrailleMath)for(var moNum=[",","."],mn=monEquation.getElementsByTagName("mn"),l=mn.length,i=0;i!==l;i++){var parent=mn[i].parentNode,moAvant=mn[i].previousElementSibling;moAvant?moAvant&&-1===moNum.indexOf(moAvant.textContent.trim())&&parent.insertBefore(document.createTextNode(mathBraille.caracMath.indicateurNumerique),mn[i]):parent.insertBefore(document.createTextNode(mathBraille.caracMath.indicateurNumerique),mn[i])}writeEq._majus(monEquation,"mn")},_mover:function(monEquation,tagName){tagName=tagName||"mover";for(var mover=monEquation.getElementsByTagName(tagName),monbool=!1;mover[0];){var tbl;0!==mover[0].getElementsByTagName("mtable").length&&writeEq._tableUnder(mover[0]);var bloc=document.createElement(tagName+"bloc"),parent=mover[0].parentNode,elt=mover[0].children,carCode=String(elt[1].textContent.trim().charCodeAt()),sep="",myArray;if(-1!==Object.keys(mathBraille.caracDec.susouscrit).indexOf(carCode))"munder"===tagName.toLowerCase()&&bloc.appendChild(document.createTextNode(mathBraille.caracMath.majuscule)),bloc.appendChild(document.createTextNode(mathBraille.caracDec.susouscrit[carCode])),mesFonctions.hasChild(elt[0],"mo")&&"mfenced"!==elt[0].tagName.toLowerCase()&&bloc.appendChild(mesFonctions.block(elt[0]))||bloc.appendChild(elt[0]);else{var enfant1=elt[0],enfant2=elt[1];switch(tagName.toLowerCase()){case"mover":sep=mathBraille.caracMath.suscrit,optionsBraille.chimie&&(sep="");break;case"munder":sep=mathBraille.caracMath.souscrit,sep=optionsBraille.chimie&&mathBraille.caracMath.point6+sep||sep;break;case"mroot":mover[0].nextElementSibling&&"mo"!==mover[0].nextElementSibling.tagName.toLowerCase()&&(monbool=!0),sep=mathBraille.caracMath.racine,enfant1=elt[1],enfant2=elt[0],bloc.appendChild(document.createTextNode(mathBraille.caracMath.exposant))}mesFonctions.nbChildrens(enfant1)>1&&!enfant1.textContent.isNumeric()&&bloc.appendChild(mesFonctions.block(enfant1))||bloc.appendChild(enfant1),bloc.appendChild(document.createTextNode(sep)),mesFonctions.nbChildrens(enfant2)>1&&!enfant2.textContent.isNumeric()&&bloc.appendChild(mesFonctions.block(enfant2))||bloc.appendChild(enfant2)}bloc=monbool&&mesFonctions.block(bloc)||bloc,parent.replaceChild(bloc,mover[0])}},_tableUnder:function(under){for(var bloc=document.createElement("mrow"),tbl=under.getElementsByTagName("mtable"),tr=tbl[0].getElementsByTagName("mtr"),ltr=tr.length,j=0;j!==ltr;j++)j!==ltr-1&&tr[j].appendChild(document.createTextNode("-2-"));for(var parent=tbl[0].parentNode;tr[0];)bloc.appendChild(tr[0]);return parent.replaceChild(bloc,tbl[0]),under},_munder:function(monEquation){writeEq._mover(monEquation,"munder")},_newMunderover:function(eq){writeEq._newMsubsupBloc(eq,"munderover")},_newMfracBloc:function(eq){for(var mfrac=eq.getElementsByTagName("mfrac");mfrac[0];){var complexe=writeEq._boolFracComplexity(mfrac[0]),parent=mfrac[0].parentNode,bloc=document.createElement("mfrac-"+complexe),bevelled=mfrac[0].getAttribute("bevelled");bevelled&&bloc.setAttribute("bevelled",bevelled),bloc.innerHTML=mfrac[0].innerHTML,parent.replaceChild(bloc,mfrac[0])}},_newMfracWrite:function(eq){for(var mfrac=mesFonctions.getElementsByContainTagName(eq,"mfrac"),indicateurBase=mathBraille.caracMath.indicateurBase&&mathBraille.caracMath.indicateurBase||"",i=0,lmfrac=mfrac.length;i<lmfrac;i++){var element=mfrac[i],tagName=element.tagName.split("-"),bloc=document.createElement("bloc"),blocSep=document.createElement("sep"),mnamebloc=["msup","msub"],parent=element.parentNode,elt=element.children,enfant1=elt[0],enfant2=elt[1],boolEnfant1=2===enfant1.children.length&&enfant1.children[0].textContent.trimall().length>1,boolEnfant2=2===enfant2.children.length&&enfant2.children[0].textContent.trimall().length>1,sep="";if(mathBraille.caracMath.indicateurFraction){var indicFrac=mathBraille.caracMath.indicateurFraction[tagName[1]],open=indicFrac.open,close=indicFrac.close,bevelled;sep=element.getAttribute("bevelled")&&mathBraille.caracMath.fraction[tagName[1]].oblique||mathBraille.caracMath.fraction[tagName[1]].horizontale}else sep=mathBraille.caracMath.fraction;blocSep.appendChild(document.createTextNode(sep)),blocSep=-1!==mnamebloc.indexOf(enfant1.tagName.split("-")[0])&&mesFonctions.block(blocSep,indicateurBase,"")||blocSep,enfant1=mesFonctions.nbChildrens(enfant1)>1&&!boolEnfant1&&mesFonctions.block(enfant1)||enfant1,enfant2=mesFonctions.nbChildrens(enfant2)>1&&!boolEnfant2&&mesFonctions.block(enfant2)||enfant2,bloc.appendChild(enfant1),bloc.appendChild(blocSep),bloc.appendChild(enfant2),bloc=mathBraille.caracMath.indicateurFraction&&mesFonctions.block(bloc,open,close)||bloc,parent.replaceChild(bloc,element)}},_boolFracComplexity:function(frac){var numerateur=frac.children[0],denominateur=frac.children[1],num=numerateur.getElementsByTagName("mfrac"),denom=denominateur.getElementsByTagName("mfrac"),lnum=num.length,ldenom=denom.length,comp=["simple","complexe","hypercomplexe"],numcomp=0,parent;if(frac.previousElementSibling&&"mn"===frac.previousElementSibling.tagName.toLowerCase()&&"mfrac"!==frac.parentElement.tagName)return"fractionnaire";return"mfrac"!==numerateur.tagName.toLowerCase()&&0===lnum&&"mfrac"!==denominateur.tagName.toLowerCase()&&0===ldenom?-1!==numerateur.textContent.indexOf("/")||-1!==denominateur.textContent.indexOf("/")?"complexe":"simple":comp[numcomp=(numcomp=numcomp<writeEq._testEnfants(denominateur)&&writeEq._testEnfants(denominateur)||numcomp)<writeEq._testEnfants(numerateur)&&writeEq._testEnfants(numerateur)||numcomp]},_testEnfants:function(elt){var comp=0;if("mfrac"===elt.tagName.toLowerCase())comp="simple"===writeEq._boolFracComplexity(elt)?1:2;else if("msub"===elt.tagName.toLowerCase()||"msup"===elt.tagName.toLowerCase())comp=0;else for(var eltenfant=elt.children,i=0,leltenfant=eltenfant.length;i!==leltenfant;i++)"mfrac"===eltenfant[i].tagName.toLowerCase()&&(comp="simple"===writeEq._boolFracComplexity(eltenfant[i])||"fractionnaire"===writeEq._boolFracComplexity(eltenfant[i])?1:2);return comp},_countParent:function(monEquation,tagname){for(var nodeTag=monEquation.getElementsByTagName(tagname),parent=nodeTag[0]&&nodeTag[0].parentElement,k=0;parent&&"math"!==parent.tagname.toLowerCase();)k++,parent=parent.parentElement;return 0===k?1e4:k},_virguleNemeth:function(msub){for(var lmsub=msub.length,i=0;i!==lmsub;i++)for(var mo=msub[i].getElementsByTagName("mo"),lmo=mo.length,j=0,bloc,parent,bool;j!==lmo;){var elt=mo[j],nextElt=elt.nextElementSibling;switch(parent=elt.parentNode,bloc=document.createElement("mo-bloc"),bool=nextElt&&(160===nextElt.textContent.charCodeAt()||"-BLANK-"===nextElt.textContent),elt.textContent.charCodeAt()){case 44:bool&&bloc.appendChild(document.createTextNode(mathBraille.caracMath.separateurIndiceExposant.virgule)),bool&&parent.replaceChild(bloc,elt),"-BLANK-"===nextElt.textContent&&parent.removeChild(nextElt),lmo--,j--;break;case 59:bool&&bloc.appendChild(document.createTextNode(mathBraille.caracMath.separateurIndiceExposant.pointvirgule)),bool&&parent.replaceChild(bloc,elt),lmo--,j--}j++}},_newMsupBloc:function(eq){for(var msup=eq.getElementsByTagName("msup");msup[0];){var parent=msup[0].parentElement,lvl=writeEq._newNiveauIndiceExposant(msup[0].children[1]),bloc=document.createElement("msup-f"),bloc2=-1===lvl&&document.createElement("bloc")||document.createElement("blocsubsup-"+lvl);bloc.innerHTML=msup[0].innerHTML,bloc2.appendChild(bloc.children[1]),parent.replaceChild(bloc,msup[0]),bloc.appendChild(bloc2)}},_conditionsIndiceNum:function(elt1,elt2,lvl){var funcTrue=["log","sin","cos","arcsin","CO"],funcFalse;return-1===["∫"].indexOf(elt1.textContent.trimall())&&(!mesFonctions.hasChild(elt2,["msub","msup","msubsup","mmultiscripts","blocIndiceNum"])&&(!(elt1.textContent.trimall().split("").length>1&&-1===funcTrue.indexOf(elt1.textContent.trimall()))&&!(-1===lvl||1!==lvl.split("").length||elt1.textContent.trimall().isNumeric()||!elt2.textContent.trimall().isNumeric())))},_newMsubBloc:function(eq){for(var msub=eq.getElementsByTagName("msub");msub[0];){var parent=msub[0].parentElement,lvl=writeEq._newNiveauIndiceExposant(msub[0].children[1]),bloc=document.createElement("msub-f"),bloc2=-1===lvl&&document.createElement("bloc")||document.createElement("blocsubsup-"+lvl);bloc2=writeEq._conditionsIndiceNum(msub[0].children[0],msub[0].children[1],lvl)&&document.createElement("blocIndiceNum-"+lvl)||bloc2,bloc.innerHTML=msub[0].innerHTML,bloc2.appendChild(bloc.children[1]),parent.replaceChild(bloc,msub[0]),bloc.appendChild(bloc2)}},_newNiveauIndiceExposant:function(elt){var tagElt=elt.tagName.split("-")[0],exlu;if(-1!==["none","mmultiscripts","mprescripts"].indexOf(tagElt))return-1;for(var parent=elt.parentElement,tagName=parent.tagName.split("-"),enfant=elt,lvl="";"math"!==tagName[0].toLowerCase();){switch(tagName[0].toLowerCase()){case"msup":lvl+="e";break;case"msub":lvl+="i";break;case"mmultiscripts":var pos=writeEq._positionDansParent(enfant);2===pos||5===pos?lvl+="e":1!==pos&&4!==pos||(lvl+="i");break;case"munderover":case"msubsup":1===(pos=writeEq._positionDansParent(enfant))?lvl+="i":2===pos&&(lvl+="e")}enfant=parent,tagName=(parent=parent.parentElement).tagName.split("-")}return""===lvl?-1:lvl},_positionDansParent:function(elt){for(var parent,enfants=elt.parentElement.children,lenfants=enfants.length,i=0;i!==lenfants;i++)if(enfants[i]===elt)return i;return-1},_newIndiceExposantWrite:function(eq){for(var indExp=["msup","msub"],indice=mathBraille.caracMath.indice,exposant=mathBraille.caracMath.exposant,indicateurBase=mathBraille.caracMath.indicateurBase&&mathBraille.caracMath.indicateurBase||"",ie=mesFonctions.getElementsByContainTagName(eq,["blocsubsup","blocmulti","blocIndiceNum","blocunderover"]),lie,j=ie.length-1;-1!==j;j--){var elt=ie[j],tagName=elt.tagName.toLowerCase().split("-"),parent=elt.parentNode;if(tagName[1]&&("blocIndiceNum"!==tagName[0]||"fr"===optionsBraille.codeBrailleMath)){var boolFrChimie=optionsBraille.chimie&&"fr"===optionsBraille.codeBrailleMath&&!mesFonctions.hasParent(elt,["mmultiscripts-f","mmultiscripts"]),txt=tagName[1].split(""),bloc=(0===elt.children[0].children.length||indExp.indexOf(-1!==tagName[0]))&&document.createElement(elt.tagName.toLowerCase())||document.createElement("bloc"),indicBaseDom;if(bloc.innerHTML=elt.innerHTML,"blocunderover"===tagName[0]?(exposant=mathBraille.caracMath.suscrit,indice=mathBraille.caracMath.souscrit):(indice=!boolFrChimie&&mathBraille.caracMath.indice||"",exposant=mathBraille.caracMath.exposant),bloc=mesFonctions.nbChildrens(bloc.children[0])>1&&mesFonctions.block(bloc)||bloc,!elt.previousElementSibling||"|"!==elt.previousElementSibling.textContent.trim()){let k=0,ltext=txt.length;for(;k!==ltext&&(bloc="e"===txt[k].toLowerCase()&&mesFonctions.block(bloc,exposant,"")||bloc,bloc="i"===txt[k].toLowerCase()&&mesFonctions.block(bloc,indice,"")||bloc,"fr"!==optionsBraille.codeBrailleMath);k++);}for(var nextElt=elt.nextElementSibling;nextElt&&"bloc"===nextElt.tagName.toLowerCase();)nextElt=nextElt.nextElementSibling;nextElt&&-1!==["mi","mo","mn"].indexOf(nextElt.tagName.toLowerCase())&&(txt.length>1&&(indicateurBase=txt[0]),bloc=mesFonctions.block(bloc,"",indicateurBase)),parent.replaceChild(bloc,elt)}}},_newBlocBase:function(eq){for(var bb=eq.getElementsByTagName("blocbase"),indicateurBase=mathBraille.caracMath.indicateurBase&&mathBraille.caracMath.indicateurBase||"";bb[0];){var parent=bb[0].parentNode,bloc=document.createElement("blocbase-f");bloc.innerHTML=bb[0].innerHTML,bloc=mesFonctions.block(bloc,indicateurBase,""),parent.replaceChild(bloc,bb[0])}},_newMsqrtBloc:function(eq,tagName){tagName=tagName||"msqrt";for(var racine=eq.getElementsByTagName(tagName);racine[0];){var parent=racine[0].parentNode,k=writeEq._radicauxEmboites(racine[0]),bloc=document.createElement(tagName+"-"+k);bloc.innerHTML=racine[0].innerHTML,parent.replaceChild(bloc,racine[0])}},_radicauxEmboites:function(racine){for(var k=0,tagName,parent=racine.parentNode;parent;)("msqrt"===(tagName=parent.tagName.toLowerCase().split("-"))[0]||"mroot"===tagName[0])&&k++,parent=parent.parentNode;return k},_newMsqrtWrite:function(eq){var racine=mesFonctions.getElementsByContainTagName(eq,"msqrt"),lracine=racine.length,i;for(i=racine[0]?lracine-1:-1;-1!==i;i--){var elt=racine[i],tagName=elt.tagName.toLowerCase().split("-"),parent=elt.parentNode,bloc=document.createElement("bloc"),enfants=elt.children,radical=mathBraille.caracMath.racine,ordre=mathBraille.caracMath.ordreRadical&&mathBraille.caracMath.ordreRadical.repeat(tagName[1]),finRadical=mathBraille.caracMath.finRacine;bloc.innerHTML=elt.innerHTML,1===enfants.length?"mrow"!==enfants[0].tagName.toLowerCase()&&"mpadded"!==enfants[0].tagName.toLowerCase()||(bloc=mesFonctions.nbChildrens(enfants[0])>1&&mesFonctions.block(bloc)||bloc):bloc=mesFonctions.block(bloc),bloc=finRadical&&mesFonctions.block(bloc,ordre+radical,ordre+finRadical)||mesFonctions.block(bloc,radical,""),parent.replaceChild(bloc,elt)}},_newMrootBloc:function(eq){writeEq._newMsqrtBloc(eq,"mroot")},_newMrootWrite:function(eq){var mroot=mesFonctions.getElementsByContainTagName(eq,"mroot"),lroot=mroot.length,i;for(i=mroot[0]?lroot-1:-1;-1!==i;i--){var elt=mroot[i],tagName=elt.tagName.toLowerCase().split("-"),parent=elt.parentNode,bloc=document.createElement("bloc"),bloccontenu=document.createElement("bloc"),enfants=elt.children,enfant0=enfants[0],enfant1=enfants[1],monbool,radical=mathBraille.caracMath.racine,ordre=mathBraille.caracMath.ordreRadical&&mathBraille.caracMath.ordreRadical.repeat(tagName[1]),finRadical=mathBraille.caracMath.finRacine,indiceRadical=mathBraille.caracMath.indiceRadical;bloccontenu.appendChild(enfant0);var child1=enfant0.children;elt.nextElementSibling&&"mo"!==elt.nextElementSibling.tagName.toLowerCase()&&(monbool=!0),elt.previousElementSibling&&"mo"!==elt.previousElementSibling.tagName.toLowerCase()&&(monbool=!0),1===child1.length?"mrow"!==child1[0].tagName.toLowerCase()&&"mpadded"!==child1[0].tagName.toLowerCase()||(bloccontenu=mesFonctions.nbChildrens(child1[0])>1&&mesFonctions.block(bloccontenu)||bloccontenu):child1.length>=1&&(bloccontenu=mesFonctions.block(bloccontenu)),bloccontenu=finRadical&&mesFonctions.block(bloccontenu,radical,"")||mesFonctions.block(bloccontenu,radical,""),bloc.appendChild(enfant1),bloc.appendChild(bloccontenu),bloc=finRadical&&mesFonctions.block(bloc,ordre+indiceRadical,ordre+finRadical)||mesFonctions.block(bloc,mathBraille.caracMath.exposant,""),bloc=!finRadical&&monbool&&mesFonctions.block(bloc)||bloc,parent.replaceChild(bloc,elt)}},_retourChariotMatrice:function(monEquation){var txt,nbcar,close,idx,j,spc="";nbcar=(txt=monEquation.textContent.split("")).indexOf(marqueMat);let paraBool=-1===monEquation.textContent.indexOf(marqueRetourLigne+mathBraille.caracMath.parenthese.open.braille())&&-1==monEquation.textContent.indexOf(marqueRetourLigne+mathBraille.caracMath.crochet.open.braille())&&-1==monEquation.textContent.indexOf(marqueRetourLigne+mathBraille.caracMath.barre.open.braille());for(-1!==nbcar&&txt.splice(nbcar,1),-1!==(close=txt.indexOf(marqueClose))?(txt.splice(close,1),nbcar=paraBool?-1!==nbcar&&nbcar-2||0:-1!==nbcar&&nbcar-1||0):nbcar=-1!==nbcar&&nbcar||0,j=0;j!==nbcar;j++)spc+=espace;for(idx=txt.indexOf(marqueRetourLigne);-1!==idx;)txt.splice(idx,1,"<br/>"+spc),idx=txt.indexOf(marqueRetourLigne,idx+1);return txt.join("")},_calculEspaceMTD:function(monEquation){var espaceEnTrop=new RegExp(espace+marqueCell+espace,"g");monEquation.textContent=monEquation.textContent.replace(espaceEnTrop,espace+marqueCell);var regex=new RegExp(marqueRetourLigne,"gi"),nbligne=monEquation.textContent.match(regex)&&monEquation.textContent.match(regex).length+1;if(null===nbligne)return monEquation.textContent;for(var txt=monEquation.textContent.split(""),lcell=[],llcell,lcol=[],llcol,posmarque=[],marque1=txt.indexOf(marqueCell),marque2=txt.indexOf(marqueCell,marque1+1),i,j,l,spc;-1!==marque1;)l=marque2-marque1-1,lcell.push(l),posmarque.push(marque2),marque1=txt.indexOf(marqueCell,marque2+1),marque2=txt.indexOf(marqueCell,marque1+1);for(llcol=(llcell=lcell.length)/nbligne,lcol.length=llcol,lcol.fill(0),i=0;i!==llcell;i++)lcell[i]>lcol[i%llcol]&&(lcol[i%llcol]=lcell[i]);for(j=0;j!==llcell;j++)if(marque2=posmarque[j],spc="",(l=lcol[j%llcol]-lcell[j])>0){for(i=1;i<=l;i++)spc+=espace;txt.splice(marque2,1,spc)}return(txt=txt.filter(writeEq._filtremarque)).join("")},_filtremarque:function(element){return element!==marqueCell},_indicateurNumerique:function(monEquation){var txt=monEquation.textContent.split(""),num=["⠴","⠂","⠆","⠒","⠲","⠢","⠖","⠶","⠦","⠔"];-1!==num.indexOf(txt[0])&&txt.splice(0,0,mathBraille.caracMath.indicateurNumerique.braille());for(var elt="BLANK".braille(),sp=txt.indexOf(elt);-1!==sp;)-1!==num.indexOf(txt[sp+1])&&txt.splice(sp+1,0,mathBraille.caracMath.indicateurNumerique.braille()),sp=txt.indexOf(elt,sp+1);return txt.join("")},_writeform:function(monEquation){monEquation.textContent=monEquation.textContent.trimall(),monEquation.textContent=monEquation.textContent.replace(/--/gi,"-"),monEquation.textContent=monEquation.textContent.braille(),monEquation.textContent=writeEq._petitsSoucis(monEquation),!optionsBraille.matriceLineaire&&!hardmat&&(monEquation.innerHTML=writeEq._calculEspaceMTD(monEquation)),monEquation.innerHTML=writeEq._retourChariotMatrice(monEquation),"nemeth"===optionsBraille.codeBrailleMath&&(monEquation.innerHTML=writeEq._indicateurNumerique(monEquation)),monEquation.innerHTML=0!==optionsBraille.coupureFormule&&writeEq._coupureFormule(monEquation,optionsBraille.coupureFormule)||monEquation.innerHTML},_petitsSoucis:function(monEquation){let txt=monEquation.textContent.replace(/⠈⠖⠖/g,"⠈⠰⠖⠆⠖");return txt=txt.replace(/⠈⠤⠤/g,"⠈⠰⠤⠆⠤"),txt},_coupureFormule:function(monEquation,long){if(-1!==monEquation.innerHTML.indexOf("<br"))return monEquation.innerHTML;long=parseInt(long);let texte=monEquation.textContent,texteCoupe="",textePlus="",cesure=mathBraille.caracMath.coupureFormule.braille()+"<br />";if(0!==long||long-1>0){let nbSplit=Math.floor(texte.length/(long-1))+1;for(let i=0;i!==nbSplit;i++)textePlus=i!==nbSplit-1&&texte.slice(i*(long-1),(i+1)*(long-1))||texte.slice(i*(long-1)),texteCoupe+=i!==nbSplit-1&&textePlus+cesure||textePlus}return texteCoupe}};exports.Mathml2braille=mbraille,exports.Brailledirect=brailledirect}(this);